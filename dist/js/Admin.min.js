"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t,e,n){var i=t("meta[name=csrf-param]").attr("content"),a=t("meta[name=csrf-token]").attr("content");t.csrf=function(t){return t=t||{},t[i]=a,t}}(jQuery,document),function(t,e,n){t.modal=function(e,n){return t(e).modal(t.extend({backdrop:"static"},n)).on("shown.bs.modal",function(){t(this).find("[autofocus=autofocus]").focus()}).on("hidden.bs.modal",function(){t(this).remove()})}}(jQuery,document),function(t,e,n){t(e).on("click",".J-admin-header .menu > ul.main > li > .text",function(){var e=t(this).parent("li");if(!e.hasClass("dropdown-hover")&&e.find("ul.dropdown, ul.dropdown-mixed").length)return e.toggleClass("dropdown-open"),!1}).on("click",function(){t(".J-admin-header .menu > ul.main > li.dropdown-open").removeClass("dropdown-open")})}(jQuery,document),function(t,e,n){t(e).on("click",".J-admin-sidebar .sidebar-control",function(){t(this).parents(".J-admin-sidebar").toggleClass("admin-sidebar-fold")}).on("click",".J-admin-sidebar ul.sidebar > li > .text",function(){var e=t(this).parent("li");e.children("ul.children").length&&e.toggleClass("fold")}),t(".J-admin-sidebar ul.sidebar > li > ul.children").each(function(){var e=t(this);e.height(e.height())})}(jQuery,document),function(t,e,n){var i=t(".J-admin-alerts"),a=["success","danger","info","warning"],s=function(){function e(t,i){var s=arguments.length<=2||arguments[2]===n?3e3:arguments[2];return _classCallCheck(this,e),this.text=t,this.type=a[i],this.delay=s,this.init()}return _createClass(e,[{key:"init",value:function(){return this.render(),this.delayClose(),this.$alert}},{key:"render",value:function(){var e=this,n=this;this.$alert=t('<div class="alert alert-'+this.type+' alert-dismissible"><button type="button" class="close"><span>&times;</span></button>'+this.text+"</div>").appendTo(i).on("click",".close",function(){n.close()}).on("webkitTransitionend transitionend",function(){!n.$alert.hasClass("alert-show")&&n.remove()}),setTimeout(function(){e.$alert.addClass("alert-show")},0)}},{key:"delayClose",value:function(){var t=this;this.timer=setTimeout(function(){t.close()},this.delay)}},{key:"close",value:function(){clearTimeout(this.timer),this.$alert.removeClass("alert-show")}},{key:"remove",value:function(){this.$alert.remove()}}]),e}();t.alert=function(t,e,i){return e===n||e===!0?e=1:e===!1&&(e=0),new s(t,e,i)}}(jQuery,document),function(t,e,n){t(e).on("click","[data-delete]",function(){var e=void 0,n=void 0,i=t(this),a=i.attr("data-delete"),s=i.attr("href")||i.attr("data-url");if(a&&s)return n=t.modal('<div class="modal fade"><div class="modal-dialog"><form class="modal-content"><fieldsed><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h5 class="modal-title">删除提示</h5></div><div class="modal-body"><p>您确定要删除吗？</p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="submit" class="btn btn-primary">确定</button></div></fieldsed></form></div></div>'),n.on("submit","form",function(){t(this).find("fieldset").prop("disabled",!0);return t.ajax({url:s,data:t.csrf({id:a}),method:"post",dataType:"json",success:function(i){i.error||(e=!0),n.modal("hide"),t.alert(i.message,i.error)}}),!1}).on("hidden.bs.modal",function(){e&&window.location.reload()}),!1})}(jQuery,document),function(t,e,n){function i(e){var n=t(this),i=n.parent(),s=+i.attr("data-attachment-max");$new=i.clone().removeAttr("data-attachment-max").removeClass("glyphicon-plus").addClass("glyphicon-picture admin-attachments"),a.call($new.find("input[type=file]").get(0),e,!0),i.before($new),s>0&&i.siblings(".admin-attachments").length>=s&&i.hide()}function a(e,n){var i=t(this),a=i.parent(),s=a.find("input[type=hidden]"),o=a.find("img"),d=a.find("p"),l=(a.find("a"),a.hasClass("admin-attachment-name"));s.length||(s=t('<input type="hidden" name="'+i.attr("data-attachment-upload")+'" />').appendTo(a)),l||o.length||(o=t("<img />").appendTo(a)),a.find("i").length||a.append('<i class="glyphicon glyphicon-remove"></i>'),l&&!d.length&&(d=t("<p></p>").appendTo(a)),s.val(e.id),l?(s.attr("data-name",e.name),d.html(e.name)):o.attr("src",i.attr("data-attachment-load-action")+"?id="+e.id),n&&i.remove()}t(e).on("uploaded.attachment.file",".J-admin-attachment input[type=file]",function(e,s){return s.error?(t.alert(s.message),!1):(t(this).parent().attr("data-attachment-max")===n?a.call(this,s.data):i.call(this,s.data),void t.alert(s.message,s.error))}).on("click",".J-admin-attachment i",function(){var e=void 0,n=void 0,i=t(this).parent();return i.hasClass("admin-attachments")?(e=i.siblings("[data-attachment-max]"),n=+e.attr("data-attachment-max"),n>0&&i.siblings(".admin-attachments").length<n&&e.show(),i.remove(),!1):(i.find("input[type=hidden]").val(""),void i.find("img, i, p").remove())}).on("click","[data-attachment-max]",function(){var e=t(this),n=+e.attr("data-attachment-max");if(n>0&&e.prevAll(".admin-attachments").length>=n)return t.alert("最多只能添加"+n+"张图片",3),!1}),t(".J-admin-attachment").each(function(){var e=t(this),n=e.find("input[type=hidden]"),i=e.find("input[type=file]"),s={id:n.val(),name:n.attr("data-name")};s.id&&a.call(i.get(0),s),e.hasClass("admin-attachment-name")&&e.append('<a href="javascript:;">点击上传文件</a>')})}(jQuery,document),function(t,e,n){var i=function(){function n(e){var i=this;_classCallCheck(this,n),this.$obj=t(e),this.$list=this.$obj.find("p"),this.$new=this.$obj.find(".new"),this.$button=this.$new.find("button"),this.url=this.$obj.attr("data-tags"),this.name=this.$button.attr("data-tag-name"),this.inputTemplate='<input type="text" class="form-control" />',this.ids=function(){var t=[];return i.$list.find("span input[type=hidden]").each(function(){t.push(+this.value)}),t}(),this.events()}return _createClass(n,[{key:"events",value:function(){var n=this,i=this;this.$obj.on("click",".new button",function(){n.newInput(),n.$button.hide(),n.$input.appendTo(n.$new).focus()}).on("keydown",".new input",function(t){switch(t.originalEvent.keyCode){case 13:return n.submit();case 27:n.cancel();break;case 38:n.press(!1);break;case 40:n.press(!0)}}).on("focus input",".new input",function(){n.like()}).on("click","p span i",function(){var e=t(this).parent("span"),n=i.ids.indexOf(+e.find("input[type=hidden]").val());n>=0&&i.ids.splice(n,1),e.fadeOut(function(){e.remove()})}),t(e).on("click",function(){n.clearDropdown()})}},{key:"unselect",value:function(){this.selectedId=null}},{key:"select",value:function(t){this.selectedId=t.addClass("selected").attr("data-id")}},{key:"press",value:function(t){if(this.$dropdown){var e=void 0,n="selected",i=t?"next":"prev",a=this.$dropdown.find("li."+n),s=this.$dropdown.find("li:"+(t?"first":"last"));a.length?(a.removeClass(n),e=a[i]("li").length?a[i]("li"):s):e=s,this.select(e)}}},{key:"clearDropdown",value:function(){this.$dropdown&&(this.$dropdown.remove(),this.$dropdown=null,this.pressDownIndex=0,this.unselect())}},{key:"dropdown",value:function(e){var n=e.length;if(!n)return void this.clearDropdown();this.unselect();var i=void 0,a=[],s=this.$input.offset(),o=this.$input.val(),d=this;s.top+=this.$input.get(0).offsetHeight,this.$dropdown=this.$dropdown||t('<ul class="admin-tags-like-list">').appendTo("body").on("click","li",function(){d.addById(t(this).attr("data-id"))}).on("mouseenter","li",function(){d.selectedId=t(this).addClass("selected").siblings(".selected").removeClass("selected").end().attr("data-id")}),this.$dropdown.css(s),this.tags={};for(var l=0;l<n;l++)if(i=e[l],!this.exists(i.id)){var r=i.name==o;a.push('<li data-id="'+i.id+'"'+(r?' class="selected"':null)+">"+i.name+"</li>"),this.tags[i.id]=i,r&&(this.selectedId=i.id)}this.$dropdown.html(a.join(""))}},{key:"like",value:function(){this.selected=null,this.$input.val()?this.post(!0):this.clearDropdown()}},{key:"add",value:function(e){return this.exists(e.id)?(this.$input.prop("disabled",!1),void t.alert("标签已添加",3)):(this.ids.push(e.id),this.$list.append('<span><input type="hidden" name="'+this.name+'" value="'+e.id+'">\n<strong>'+e.name+'</strong>\n<i class="glyphicon glyphicon-remove"></i>\n</span>'),void this.cancel())}},{key:"exists",value:function(e){return t.inArray(e,this.ids)>=0}},{key:"addById",value:function(t){this.tags[t]&&this.add(this.tags[t])}},{key:"submit",value:function(){return this.selectedId?this.addById(this.selectedId):this.$input.val()?(this.$input.prop("disabled",!0),this.post()):t.alert("请输入标签名",3),!1}},{key:"cancel",value:function(){this.$input.remove(),this.$button.show(),this.clearDropdown()}},{key:"newInput",value:function(){this.$input=t(this.inputTemplate)}},{key:"post",value:function(e){var n=this;t.ajax({url:this.url,data:t.csrf({name:this.$input.val(),like:e}),method:"post",dataType:"json",success:function(t){t.error||n[e?"dropdown":"add"](t.data)}})}}]),n}();t("[data-tags]").each(function(){new i(this)})}(jQuery,document);
//# sourceMappingURL=Admin.min.js.map
